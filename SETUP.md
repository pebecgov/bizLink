# P-BID Platform Setup Guide

## Prerequisites

- Node.js 18+ installed
- Clerk account (free tier works)
- Convex account (free tier works)

## Step-by-Step Setup

### 1. Install Dependencies

```bash
npm install
```

### 2. Setup Clerk

1. Go to [Clerk Dashboard](https://dashboard.clerk.com)
2. Create a new application
3. Copy the following keys from the API Keys section:
   - `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY`
   - `CLERK_SECRET_KEY`

### 3. Setup Convex

1. Go to [Convex Dashboard](https://dashboard.convex.dev)
2. Create a new project
3. Run the Convex dev server to initialize:
   ```bash
   npx convex dev
   ```
4. This will:
   - Create a `.env.local` file with your Convex deployment key
   - Generate TypeScript types from your schema
   - Start the Convex development server

### 4. Configure Environment Variables

Create a `.env.local` file in the project root:

```env
# Clerk Authentication
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...

# Clerk URLs (optional, defaults shown)
NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up
NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL=/
NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL=/

# Convex Backend (auto-generated by `npx convex dev`)
CONVEX_DEPLOYMENT_KEY=...
NEXT_PUBLIC_CONVEX_URL=...

# Clerk Webhook Secret (see step 5)
WEBHOOK_SECRET=whsec_...
```

### 5. Setup Clerk Webhook

1. In Clerk Dashboard, go to **Webhooks**
2. Click **Add Endpoint**
3. For local development, use a tool like [ngrok](https://ngrok.com) or [Clerk's webhook testing](https://clerk.com/docs/integrations/webhooks/overview)
4. Set the endpoint URL to: `https://your-domain.com/api/webhooks/clerk`
5. Subscribe to these events:
   - `user.created`
   - `user.updated`
6. Copy the **Signing Secret** and add it to `.env.local` as `WEBHOOK_SECRET`

### 6. Run the Development Server

In one terminal:
```bash
npx convex dev
```

In another terminal:
```bash
npm run dev
```

Visit `http://localhost:3000` to see your application.

## Verification Checklist

- [ ] Clerk authentication works (sign in/sign up)
- [ ] Users are automatically synced to Convex on registration
- [ ] User roles are visible in the UI
- [ ] Audit logs are being created (check Convex dashboard)
- [ ] RBAC is enforced (try accessing admin-only mutations)

## Troubleshooting

### Users not syncing to Convex

1. Check that the Clerk webhook is configured correctly
2. Verify `WEBHOOK_SECRET` is set in `.env.local`
3. Check the webhook logs in Clerk Dashboard
4. Check Convex logs: `npx convex logs`

### TypeScript errors

Run `npx convex dev` to regenerate types after schema changes.

### Authentication errors

1. Verify Clerk keys are correct in `.env.local`
2. Check that middleware is protecting routes correctly
3. Ensure Clerk application is in development mode

## Next Steps

After setup is complete, you can:
- Create admin users via Convex dashboard
- Test RBAC by creating mutations with different roles
- Review audit logs in the `audit_logs` table
- Proceed to Module 2: Business Verification

